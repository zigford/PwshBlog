<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="main.css" type="text/css" />
<link rel="stylesheet" href="blog.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" title="Subscribe to this page..." href="feed.rss" />
<title>zigford.org &mdash; Posts tagged "gentoo"</title>
</head><body>
<div id="divbodyholder">
<div class="headerholder"><div class="header">
<div id="title">
<h1 class="nomargin"><a class="ablack" href="http://zigford.org/index.html">zigford.org</a></h1>
<div id="description"><a href="about.html">About</a><a href="links.html"> | Links</a><a href="scripts.html"> | Scripts</a><br>Sharing linux/windows scripts and tips</br></div>
</div></div></div>
<div id="divbody"><div class="content">
<h3><a class="ablack" href="gentoo-local-overlay.html">
Gentoo local overlay
</a></h3>
<!-- bashblog_timestamp: #201809180909.41# -->
<div class="subtitle">September 18, 2018 &mdash; 
Jesse Harris
</div>
<!-- text begin -->

<p>I find myself having to create a local overlay to test/develop a new ebuild
without affecting my main system from time to time. I usually fire up a clean
kvm Gentoo guest to start working on, but I've usually forgotten the proceedure</p>

<p>This is a quick instruction on a straight-forward local overlay</p>

<ol>
<li><p>Create the local path tree where the overlay will reside:</p>

<pre><code>mkdir -p /usr/local/portage/overlay/{metadata,profiles}
</code></pre></li>
<li><p>Create the <code>layout.conf</code> file and <code>repo_name</code> file</p>

<pre><code>cd /usr/local/portage/overlay
echo "masters = gentoo" &gt; metadata/layout.conf
echo  "$(hostname)" &gt; profiles/repo_name
</code></pre></li>
<li><p>Create a repos.conf file:</p>

<pre><code>cat &lt;&lt;EOF&gt;/etc/portage/repos.conf/$(hostname).conf
[$(hostname)]
location = /usr/local/portage/overlay
auto-sync = no
priority = 10
EOF
</code></pre></li>
</ol>

<h2>done.</h2>

<p>Now you can begin to populate the local repo with custom ebuilds. I usually do
this and then upload my new ebuild to my <a href="https://github.com/zigford/gentoo-zigford">github</a> repository.</p>

<p>See also:</p>

<p><a href="https://wiki.gentoo.org/wiki//etc/portage/repos.conf">repos.conf</a>, <a href="https://wiki.gentoo.org/wiki/Custom_repository">Custom Repository</a></p>

<p>Tags: <a href='tag_gentoo.html'>gentoo</a>, <a href='tag_portage-overlay.html'>portage-overlay</a></p>

<!-- text end -->
<h3><a class="ablack" href="snaps-on-gentoo.html">
Snaps on Gentoo
</a></h3>
<!-- bashblog_timestamp: #201808122312.04# -->
<div class="subtitle">August 12, 2018 &mdash; 
Jesse Harris
</div>
<!-- text begin -->

<h2>Why?</h2>

<p>Many will think it is heresy to put binary packages on a Gentoo system 
let alone a package system which encourages binary packages to come with
their own set of shared libraries. </p>

<p>While I tend to agree, the practicality of sticking to this arrangement 
can be difficult for a couple of cases. Here are a few I can think of:</p>

<ul>
<li>Source not available</li>
<li>No binary package or source ebuild for Gentoo</li>
<li>ebuild takes too long to compile</li>
</ul>

<p>In the case of ebuilds taking too long (eg. chromium), I have a limited
budget and can't really afford to leave my power hungry desktop on 24/7
to keep chromium builds up-to-date.</p>

<p>Here are a quick list of software that I use which fall into one of these 
categories:</p>

<ul>
<li>Citrix Reciever</li>
<li>Powershell (Available as source, but no ebuild and I haven't had the 
time to try write one myself)</li>
<li>Minecraft (Gaming with the kids)</li>
<li>Discord (Chatting with games)</li>
<li>Chromium (Primarily a firefox user, but have some trouble with getting it 
to see and work with Citrix)</li>
</ul>

<p>With my excuses for putting snap's on Gentoo out of the way, here is how 
I've got it working for my systems.</p>

<h2>Overlay</h2>

<p>There are a few overlay's for Gentoo out there. Even an official one 
maintained (or as the case may be, unmaintained) by 
<a href="https://github.com/zyga">zyga</a> from Canonical. I tried that one, and many 
of the forks with no such luck.</p>

<p>After googling around I stumbled on a thread on 
<a href="https://forum.snapcraft.io/t/gentoo-update-needed/3029/15">snapcraft.io</a> 
and a post from user jamesb192 about the progress on their snapd overlay. </p>

<p><a href="https://github.com/JamesB192/JamesB192-overlay">JamesB192 overlay</a> works,
but it doesn't have an overlay.xml file for adding with layman. 
To overcome this, I've hosted one on my site 
<a href="http://jesseharrisit.com/overlay.xml">here</a>. You can add this to your 
system using overlay like this:</p>

<pre><code>        echo app-portage/layman git &gt;&gt; /etc/portage/package.use/layman
        emerge app-portage/layman
        layman -o http://jesseharrisit.com/overlay.xml -f -a JamesB192
</code></pre>

<p>Now that you have the overlay installed should be able to emerge snapd 
like so:</p>

<pre><code>        emerge app-emulation/snapd
</code></pre>

<p><em>Note - You may need to adjust your kernel config and the ebuild is 
pretty good at highlighting which options need to be set.</em></p>

<h2>Issues</h2>

<p>During my testing of snaps on Gentoo, I've come across a couple of issues 
that either have been solved or could be solved in the ebuild</p>

<ol>
<li>snap packages only install and run as root (This was solved by setting 
suid on /usr/lib64/snapd/snap-confine, and solved in ebuild 2.34)</li>
<li>/var/lib/snapd not created (manually mkdir the directory)</li>
</ol>

<h2>Final thoughts.</h2>

<p>Snap packages feel like a great augmentation for Gentoo. It allows me to 
keep using Gentoo as a daily driver and augment some of it's missing 
packages with packages from more popular distros.</p>

<p>Tags: <a href='tag_gentoo.html'>gentoo</a>, <a href='tag_snaps.html'>snaps</a>, <a href='tag_overlay.html'>overlay</a></p>






<!-- text end -->
<h3><a class="ablack" href="downgrade-gentoo-from-testing-to-stable.html">
Downgrade Gentoo from testing to stable
</a></h3>
<!-- bashblog_timestamp: #201808051006.29# -->
<div class="subtitle">August 05, 2018 &mdash; 
Jesse Harris
</div>
<!-- text begin -->

<p>At some point in my main Gentoo boxes life I added the ~amd64 keyword into 
my make.conf. I don't remeber why I did this, but I can't think of a reason
I need my entire install to be bleeding edge.</p>

<p>I did some googling around on the best approach to achieve this and from
what I read on forums, having a bunch of testing packages downgrade to 
stable is not such a good idea. </p>

<p>One reason might be that per app config files are usually only designed to 
be backward compatible, not forward compatible.</p>

<p>At any rate, the idea is to gather a list of currently installed testing
packages and add them to package.keywords for their current version.</p>

<p>With this method, eventually those packages will become stable.</p>

<p>The method I used is basically from the <a href="https://wiki.sabayon.org/index.php?title=HOWTO:_Switch_from_Test_to_Stable_Packages">sabayon wiki</a> with a few
tweaks.</p>

<ol>
<li><p>First, edit make.conf ACCEPT_KEYWORDS to:</p>

<pre><code>ACCEPT_KEYWORDS=amd64
</code></pre></li>
<li><p>Now use equery, sed and grep to construct a new packge.keywords</p>

<pre><code>equery -C -N list -F '=$cpv $mask2' '*' | \
    grep \~ | sed 's/\[~amd64 keyword\]/~amd64/' &gt; \
    /etc/portage/package.keywords/testpackages
</code></pre>

<p><em>Basically I added '-C' to remove colours and grep</em></p></li>
<li><p>Examine testpackages for sanity, and then test with a world upgrade.</p>

<pre><code>emerge --ask --update --newuse --deep --with-bdeps=y @world


These are the packages that would be merged, in order:


Calculating dependencies... done!


Nothing to merge; quitting.
</code></pre></li>
</ol>

<p>Tags: <a href='tag_gentoo.html'>gentoo</a>, <a href='tag_portage.html'>portage</a></p>






<!-- text end -->
<h3><a class="ablack" href="using-the-latest-vim-on-gentoo.html">
Using the latest vim on Gentoo
</a></h3>
<!-- bashblog_timestamp: #201805221018.38# -->
<div class="subtitle">May 22, 2018 &mdash; 
Jesse Harris
</div>
<!-- text begin -->

<p>Most people (including myself until recently), think of Gentoo as a bleeding 
edge source distribution. This is pretty far from accurate as most packages 
marked stable are quite out of date. And even if you decide to accept all 
unstable packages by adding: </p>

<pre><code>        ACCEPT_KEYWORKS="~amd64"
</code></pre>

<p>to your make.conf file, you will likely be a bit disappointed when you can't 
get the latest gnome bits.</p>

<p>As my last post indicated, I'm a bit of a vim user and I want to have the 
latest vim on all my machines (Windows at work, WSL/Ubuntu 18.04 on the 
Windows box, and Gentoo at home).
To that end, here is the simple thing you need to do to get the latest Vim on 
Gentoo:</p>

<h1>Overview</h1>

<ol>
<li>Add a special keyword to vim's ACCEPT_KEYWORDS var</li>
<li>Unmerge existing vim</li>
<li>emerge the new vim</li>
</ol>

<h2>Keywords</h2>

<p>Newer versions of portage allow <em>/etc/portage/package.keywords</em> to be a 
directory with simple files so that you can seperate files for seperate
packages. Now, lets check if it is a file or dir and convert it if it is 
a directory.</p>

<pre><code>    cd /etc/portage
    if test -f package.keywords; then
        mv package.keywords keywords
        mkdir package.keywords
        mv keywords package.keywords/
    fi
</code></pre>

<p>And now, lets use the special keyword for the vim package which will
allow ebuilds from github</p>

<pre><code>    echo app-editors/vim "**" &gt; package.keywords/vim
    echo app-editors/gvim "**" &gt;&gt; package.keywords/vim
    echo app-editors/vim-core "**" &gt;&gt; package.keywords/vim
</code></pre>

<h2>Unmerge existing vim</h2>

<pre><code>    emerge --unmerge app-editors/vim app-editors/gvim
</code></pre>

<h2>Merge the new vim</h2>

<pre><code>    emerge app-editors/vim app-editors/gvim
</code></pre>

<h2>Final thoughts.</h2>

<p>This is the way I did it, but thinking about it now, it may be unnessecary
to unmerge vim. You could probably get away with running <em>emerge --update vim gvim</em></p>

<p>Tags: <a href='tag_gentoo.html'>gentoo</a>, <a href='tag_vim.html'>vim</a>, <a href='tag_git.html'>git</a>, <a href='tag_ebuild.html'>ebuild</a></p>







<!-- text end -->
<h3><a class="ablack" href="burning-a-dvd-video-on-gentoo.html">
Burning a DVD Video on Gentoo
</a></h3>
<!-- bashblog_timestamp: #201805151427.11# -->
<div class="subtitle">May 15, 2018 &mdash; 
Jesse Harris
</div>
<!-- text begin -->

<p>Quick note for my future self</p>

<h1>Overview</h1>

<ol>
<li>Convert media to dvd compatible format</li>
<li>Author DVD title</li>
<li>Author DVD Table of Contents</li>
<li>Convert DVD folder to ISO</li>
<li>(Optional) Loopback mount ISO and test.</li>
<li>Burn ISO to DVD</li>
</ol>

<h1>Packages Required</h1>

<p>media-video/ffmpeg <br />
media-video/dvdauthor <br />
app-cdr/dvd+rw-tools  </p>

<h1>Commands</h1>

<p>Start by using ffmpeg to convert the media to a dvd compatible format:</p>

<pre><code>        ffmpeg -i Big\ Buck\ Bunny.mp4 -target pal-dvd BigBuckBunny.mpg
</code></pre>

<p>Now use dvdauthor to author a title</p>

<pre><code>        dvdauthor -t -o dvd --video=pal -f BigBuckBunny.mpg
</code></pre>

<p>Add a table of contents</p>

<pre><code>        dvdauthor -T -o dvd
</code></pre>

<p>Create the ISO file</p>

<pre><code>        mkisofs -dvd-video -o BigBuckBunny.iso dvd/
</code></pre>

<p>(Optional) Mount to a loopback for testing</p>

<pre><code>        mkdir mount
        mount -o loop BigBuckBunny.iso mount/
</code></pre>

<p>Play the video using VLC or some other tool to check it, then unmount</p>

<pre><code>        umount mount/
</code></pre>

<p>Burn to a disc</p>

<pre><code>        growisofs -dvd-compat -Z /dev/sr0=BigBuckBunny.iso
</code></pre>

<p>Credit to <a href="https://ubuntuforums.org/showthread.php?t=2121309">andrew.46 over at the ubuntuforums</a></p>

<p>Tags: <a href='tag_burn-a-dvd.html'>burn-a-dvd</a>, <a href='tag_gentoo.html'>gentoo</a>, <a href='tag_ffmpeg.html'>ffmpeg</a>, <a href='tag_linux.html'>linux</a></p>







<!-- text end -->
</div>
<div id="footer">&copy <a href="http://twitter.com/zigford_org">Jesse Harris</a> &mdash; <a href="mailto:jesse&#64;zigford&#46;org">jesse&#64;zigford&#46;org</a><br/>
Generated with <a href="https://github.com/cfenollosa/bashblog">bashblog</a>, a single bash script to easily create blogs like this one</div>
</div></div>
</body></html>
